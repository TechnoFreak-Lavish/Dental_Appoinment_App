<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>View Appointments</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <style>
    body {
      background: linear-gradient(to right, #4facfe, #00f2fe);
      display: flex;
      height: 100vh;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    .container {
      width: 100%;
      max-width: 500px;
    }
    .card {
      width: 100%;
    }
  </style>
  <body>
    <div class="container">
      <h2 class="text-center mb-3">My Upcoming Appointments</h2>
      <div id="appointmentsList" class="mb-3"></div>
      <a href="appointments.html" class="btn btn-secondary w-100"
        >Back to Appointments</a
      >
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const appointmentsList = document.getElementById("appointmentsList");

        const token = localStorage.getItem("token");
        if (!token) {
          appointmentsList.innerHTML = `<p class="text-center text-danger">You must be logged in to view appointments.</p>`;
          return;
        }

        try {
          const response = await fetch(
            "http://localhost:5000/api/appointments/my-appointments",
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (!response.ok) {
            throw new Error("Failed to fetch appointments.");
          }

          const appointments = await response.json();

          if (appointments.length === 0) {
            appointmentsList.innerHTML = `<p class="text-center text-muted">No upcoming appointments found.</p>`;
            return;
          }

          appointmentsList.innerHTML = appointments
            .map((appt) => {
              return `
                <div class="card p-3 mb-2 shadow-sm">
                  <p><strong>Patient:</strong> ${appt.name || "N/A"}</p>
                  <p><strong>Date:</strong> ${appt.date}</p>
                  <p><strong>Time:</strong> ${appt.slot}</p>
                  <p><strong>Reason:</strong> ${appt.reason || "N/A"}</p>
                </div>
              `;
            })
            .join("");
        } catch (err) {
          appointmentsList.innerHTML = `<p class="text-center text-danger">${err.message}</p>`;
        }
      });
    </script>
  </body>
</html>
